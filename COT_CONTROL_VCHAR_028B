ELECT /*+ NO_CPU_COSTING */  A.OPRID, A.RUN_CNTL_ID, B.VENDOR_ID, B.VNDR_LOC, B.CURRENCY_PYMNT, B.VOUCHER_ID, B.PYMNT_CNT, B.APPR_STATUS, B.INVOICE_ID, B.AP_VCHR_CAT, TO_CHAR(B.INVOICE_DT,'YYYY-MM-DD'), TO_CHAR(B.SCHEDULED_PAY_DT,'YYYY-MM-DD'), TO_CHAR(B.DFT_MAT_DT,'YYYY-MM-DD'), B.PYMNT_GROSS_AMT, B.DFT_SIGHT_CD, TO_CHAR(B.ENTERED_DT,'YYYY-MM-DD'), B.BANK_SETID, B.BANK_CD, B.BANK_ACCT_KEY, C.VENDOR_NAME_SHORT, C.NAME1, A.SEQ_NBR, E.PYMNT_GROUP_CD, B.PYMNT_METHOD, B.PYMNT_HOLD, G.NAME1, G.NAME2, H.FIELDVALUE, H.XLATSHORTNAME,H.FIELDNAME,TO_CHAR(H.EFFDT,'YYYY-MM-DD')
  FROM PS_COT_PVC_TAO A, PS_VENDOR C, PS_VENDOR_PAY E, PS_VENDOR_ADDR G, PSXLATITEM H, PS_COT_CTRLCOMP_VW B
  WHERE ( A.OPRID = '706829'
    AND ( A.OPRID = :1
     AND C.SETID = (SELECT D.SETID
  FROM PS_SET_CNTRL_REC D
  WHERE D.RECNAME = 'VENDOR'
     AND D.SETCNTRLVALUE = A.BUSINESS_UNIT)
     AND C.VENDOR_ID = A.VENDOR_ID
     AND C.SETID = E.SETID
     AND C.VENDOR_ID = E.VENDOR_ID
     AND E.EFFDT =
        (SELECT MAX(E_ED.EFFDT) FROM PS_VENDOR_PAY E_ED
        WHERE E.SETID = E_ED.SETID
          AND E.VENDOR_ID = E_ED.VENDOR_ID
          AND E.VNDR_LOC = E_ED.VNDR_LOC
          AND E_ED.EFFDT <= SYSDATE)
     AND E.SEQ_NUM = (SELECT MAX( F.SEQ_NUM)
  FROM PS_VENDOR_PAY F
  WHERE F.EFFDT = E.EFFDT
     AND F.SETID = E.SETID
     AND F.VENDOR_ID = E.VENDOR_ID
     AND F.VNDR_LOC = E.VNDR_LOC)
     AND C.SETID = G.SETID
     AND C.VENDOR_ID = G.VENDOR_ID
     AND G.EFFDT =
        (SELECT MAX(G_ED.EFFDT) FROM PS_VENDOR_ADDR G_ED
        WHERE G.SETID = G_ED.SETID
          AND G.VENDOR_ID = G_ED.VENDOR_ID
          AND G.ADDRESS_SEQ_NUM = G_ED.ADDRESS_SEQ_NUM
          AND G_ED.EFFDT <= SYSDATE)
     AND H.EFFDT =
        (SELECT MAX(H_ED.EFFDT) FROM PSXLATITEM H_ED
        WHERE H.FIELDNAME = H_ED.FIELDNAME
          AND H.FIELDVALUE = H_ED.FIELDVALUE
          AND H_ED.EFFDT <= SYSDATE)
     AND H.FIELDNAME = 'INVOICE_CNT'
     AND H.FIELDVALUE <= A.INVOICE_CNT
     AND B.BUSINESS_UNIT = A.BUSINESS_UNIT
     AND B.CURRENCY_PYMNT = A.CURRENCY_PYMNT
     AND B.VENDOR_ID = A.VENDOR_ID
     AND B.PYMNT_HOLD = 'N'
     AND B.VNDR_LOC = A.VNDR_LOC
     AND B.APPR_STATUS = 'A'
     AND B.VENDOR_ID = G.VENDOR_ID
     AND B.ADDRESS_SEQ_NUM = G.ADDRESS_SEQ_NUM
     AND B.VENDOR_ID = E.VENDOR_ID
     AND B.VNDR_LOC = E.VNDR_LOC
     AND B.VNDR_LOC = A.VNDR_LOC ) )
  ORDER BY 28, 12, 11, 9
